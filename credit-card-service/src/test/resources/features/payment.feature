# language: zh-TW
@payment
功能: 信用卡付款處理
  作為電子商務系統
  我需要處理信用卡付款
  以便完成訂單交易

  背景:
    假設 信用卡服務已啟動

  @positive @happy-path
  場景: 成功處理付款請求
    假設 一個有效的付款請求，交易ID為 "550e8400-e29b-41d4-a716-446655440001"
    當 發送付款通知請求
    那麼 應該收到成功的付款回應
    而且 回應應包含授權碼

  @positive @idempotent
  場景: 冪等性 - 重複付款請求返回相同結果
    假設 一個有效的付款請求，交易ID為 "550e8400-e29b-41d4-a716-446655440002"
    當 發送付款通知請求
    而且 再次發送相同的付款通知請求
    那麼 兩次回應應該相同
    而且 應該只處理一次付款

  @positive @rollback
  場景: 成功退款已付款的交易
    假設 一個有效的付款請求，交易ID為 "550e8400-e29b-41d4-a716-446655440003"
    當 發送付款通知請求
    而且 收到成功的付款回應
    當 發送退款請求
    那麼 應該收到成功的退款回應
    而且 退款訊息應為 "Payment refunded successfully"

  @positive @rollback-idempotent
  場景: 冪等性 - 重複退款請求返回相同結果
    假設 一個有效的付款請求，交易ID為 "550e8400-e29b-41d4-a716-446655440004"
    當 發送付款通知請求並成功
    當 發送退款請求
    那麼 第一次退款訊息應為 "Payment refunded successfully"
    當 再次發送相同的退款請求
    那麼 第二次退款訊息應為 "Payment already refunded"

  @negative @no-payment
  場景: 退款不存在的付款 - 無操作
    假設 一個退款請求，交易ID為 "550e8400-e29b-41d4-a716-446655440005"
    當 發送退款請求給不存在的付款
    那麼 應該收到成功的退款回應
    而且 退款訊息應為 "No payment to rollback"

  @negative @failure-simulation
  場景: 模擬付款失敗
    假設 信用卡服務配置為失敗模式
    假設 一個有效的付款請求，交易ID為 "550e8400-e29b-41d4-a716-446655440006"
    當 發送付款通知請求
    那麼 應該收到失敗的付款回應
    而且 失敗訊息應包含 "Payment declined"
