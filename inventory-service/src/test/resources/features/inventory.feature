# language: zh-TW
@inventory
功能: 庫存管理
  作為電子商務系統
  我需要管理商品庫存
  以便確保訂單能正確預留和釋放庫存

  背景:
    假設 庫存服務已啟動

  @positive @happy-path
  場景: 成功預留庫存
    假設 一個有效的庫存預留請求，交易ID為 "660e8400-e29b-41d4-a716-446655440001"
    當 發送庫存預留請求
    那麼 應該收到成功的預留回應
    而且 回應應包含預留編號

  @positive @idempotent
  場景: 冪等性 - 重複預留請求返回相同結果
    假設 一個有效的庫存預留請求，交易ID為 "660e8400-e29b-41d4-a716-446655440002"
    當 發送庫存預留請求
    而且 再次發送相同的庫存預留請求
    那麼 兩次預留回應應該相同
    而且 應該只預留一次庫存

  @positive @rollback
  場景: 成功釋放已預留的庫存
    假設 一個有效的庫存預留請求，交易ID為 "660e8400-e29b-41d4-a716-446655440003"
    當 發送庫存預留請求
    而且 收到成功的預留回應
    當 發送庫存釋放請求
    那麼 應該收到成功的釋放回應
    而且 釋放訊息應為 "Inventory released successfully"

  @positive @rollback-idempotent
  場景: 冪等性 - 重複釋放請求返回相同結果
    假設 一個有效的庫存預留請求，交易ID為 "660e8400-e29b-41d4-a716-446655440004"
    當 發送庫存預留請求並成功
    當 發送庫存釋放請求
    那麼 第一次釋放訊息應為 "Inventory released successfully"
    當 再次發送相同的釋放請求
    那麼 第二次釋放訊息應為 "Inventory already released"

  @negative @no-reservation
  場景: 釋放不存在的預留 - 無操作
    假設 一個釋放請求，交易ID為 "660e8400-e29b-41d4-a716-446655440005"
    當 發送釋放請求給不存在的預留
    那麼 應該收到成功的釋放回應
    而且 釋放訊息應為 "No reservation to release"

  @negative @failure-simulation
  場景: 模擬庫存不足失敗
    假設 庫存服務配置為失敗模式
    假設 一個有效的庫存預留請求，交易ID為 "660e8400-e29b-41d4-a716-446655440006"
    當 發送庫存預留請求
    那麼 應該收到失敗的預留回應
    而且 失敗訊息應包含 "Out of stock"
